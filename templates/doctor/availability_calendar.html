{% extends "doctor/base.html" %}
{% load static %}
{% load i18n %}

{% block title %}Calendrier de Disponibilité - BINTACURA{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/availability.css' %}">
{% endblock %}

{% block content %}
<div class="availability-container">
    <div class="page-header">
        <h1><i class="fas fa-calendar-alt"></i> Calendrier de Disponibilité</h1>
        <p class="subtitle">Gérez vos créneaux horaires et disponibilités</p>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="btn btn-primary" onclick="openBulkSlotModal()">
            <i class="fas fa-plus"></i> Créer des Créneaux en Masse
        </button>
        <button class="btn btn-secondary" onclick="openRecurringModal()">
            <i class="fas fa-sync"></i> Disponibilité Récurrente
        </button>
        <button class="btn btn-warning" onclick="openBlockTimeModal()">
            <i class="fas fa-ban"></i> Bloquer du Temps
        </button>
    </div>

    <!-- Calendar View -->
    <div class="calendar-section">
        <div class="calendar-controls">
            <button class="btn-nav" onclick="previousWeek()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <h3 id="currentWeek">Semaine du {{ current_date|date:"d F Y" }}</h3>
            <button class="btn-nav" onclick="nextWeek()">
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="btn btn-sm" onclick="goToToday()">Aujourd'hui</button>
        </div>

        <div class="weekly-calendar" id="weeklyCalendar">
            <!-- Calendar will be rendered here by JavaScript -->
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon bg-primary">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <h3 id="totalSlots">0</h3>
                <p>Créneaux cette semaine</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon bg-success">
                <i class="fas fa-check"></i>
            </div>
            <div class="stat-content">
                <h3 id="bookedSlots">0</h3>
                <p>Réservés</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon bg-warning">
                <i class="fas fa-hourglass-half"></i>
            </div>
            <div class="stat-content">
                <h3 id="availableSlots">0</h3>
                <p>Disponibles</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon bg-danger">
                <i class="fas fa-ban"></i>
            </div>
            <div class="stat-content">
                <h3 id="blockedSlots">0</h3>
                <p>Bloqués</p>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Slot Creation Modal -->
<div id="bulkSlotModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeBulkSlotModal()">&times;</span>
        <h2>Créer des Créneaux en Masse</h2>
        <form id="bulkSlotForm">
            {% csrf_token %}
            <div class="form-group">
                <label>Période</label>
                <div class="date-range">
                    <input type="date" name="start_date" required>
                    <span>à</span>
                    <input type="date" name="end_date" required>
                </div>
            </div>
            <div class="form-group">
                <label>Jours de la Semaine</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="days" value="1"> Lundi</label>
                    <label><input type="checkbox" name="days" value="2"> Mardi</label>
                    <label><input type="checkbox" name="days" value="3"> Mercredi</label>
                    <label><input type="checkbox" name="days" value="4"> Jeudi</label>
                    <label><input type="checkbox" name="days" value="5"> Vendredi</label>
                    <label><input type="checkbox" name="days" value="6"> Samedi</label>
                    <label><input type="checkbox" name="days" value="0"> Dimanche</label>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Heure de Début</label>
                    <input type="time" name="start_time" required>
                </div>
                <div class="form-group">
                    <label>Heure de Fin</label>
                    <input type="time" name="end_time" required>
                </div>
            </div>
            <div class="form-group">
                <label>Durée par Créneau (minutes)</label>
                <select name="slot_duration" required>
                    <option value="15">15 minutes</option>
                    <option value="30" selected>30 minutes</option>
                    <option value="45">45 minutes</option>
                    <option value="60">1 heure</option>
                </select>
            </div>
            <div class="form-group">
                <label>Type de Consultation</label>
                <select name="consultation_type">
                    <option value="cabinet">Au Cabinet</option>
                    <option value="video">Vidéo Consultation</option>
                    <option value="both">Les Deux</option>
                </select>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeBulkSlotModal()">Annuler</button>
                <button type="submit" class="btn btn-primary">Créer les Créneaux</button>
            </div>
        </form>
    </div>
</div>

<!-- Block Time Modal -->
<div id="blockTimeModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeBlockTimeModal()">&times;</span>
        <h2>Bloquer du Temps</h2>
        <form id="blockTimeForm">
            {% csrf_token %}
            <div class="form-group">
                <label>Motif</label>
                <input type="text" name="reason" placeholder="Ex: Congés, Formation, etc." required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Date de Début</label>
                    <input type="datetime-local" name="start_datetime" required>
                </div>
                <div class="form-group">
                    <label>Date de Fin</label>
                    <input type="datetime-local" name="end_datetime" required>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeBlockTimeModal()">Annuler</button>
                <button type="submit" class="btn btn-warning">Bloquer</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/availability.js' %}"></script>
{% endblock %}
